# Instagramæ—¥åˆ¥çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ¬ãƒãƒ¼ãƒˆ

**ãƒ¬ãƒãƒ¼ãƒˆç•ªå·**: 02  
**ä½œæˆæ—¥**: 2025-06-25  
**æ¤œè¨¼ç¯„å›²**: Instagram Graph API ã«ã‚ˆã‚‹æ—¥åˆ¥çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—å¯èƒ½æ€§ã®åŒ…æ‹¬çš„èª¿æŸ»  
**ç›®çš„**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒ daily_stats ãƒ†ãƒ¼ãƒ–ãƒ«ç›¸å½“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹éš›ã®å®Œå…¨ãªã‚¬ã‚¤ãƒ‰

---

## ğŸ“‹ è¦ç´„

Instagram Graph API ã‚’ä½¿ç”¨ã—ãŸæ—¥åˆ¥çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—å¯èƒ½æ€§ã‚’åŒ…æ‹¬çš„ã«èª¿æŸ»ã—ã¾ã—ãŸã€‚æ—¢å­˜ã®DBè¨­è¨ˆã«æ‹˜ã‚‰ãšã€å®Ÿéš›ã«å–å¾—å¯èƒ½ãªå…¨ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œè¨¼ã—ã€ä»£æ›¿æ¡ˆã‚’å«ã‚€å®Ÿè£…æˆ¦ç•¥ã‚’ç­–å®šã—ã¾ã—ãŸã€‚

### ä¸»è¦ãªç™ºè¦‹
- âœ… **åˆè¨ˆ19è¦ç´ **ã®ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—å¯èƒ½
- âœ… **Insights API**: 2å€‹ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆfollower_count, reachï¼‰
- âœ… **åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: 11å€‹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±
- âœ… **æŠ•ç¨¿é›†ç´„**: 6å€‹ã®ç®—å‡ºå¯èƒ½ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- âŒ å¤šãã®æœŸå¾…ã•ã‚Œã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆprofile_views, website_clicksç­‰ï¼‰ã¯å–å¾—ä¸å¯

---

## ğŸ” æ¤œè¨¼æ‰‹æ³•

### å®Ÿæ–½ã—ãŸèª¿æŸ»
1. **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ¢ç´¢**: åˆ©ç”¨å¯èƒ½ãªAPI ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å…¨æ•°èª¿æŸ»
2. **ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ¤œè¨¼**: å„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®æœŸé–“ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ¥è©³ç´°ãƒ†ã‚¹ãƒˆ
3. **åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã®å–å¾—å¯èƒ½æ€§æ¤œè¨¼
4. **æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿é›†ç´„**: æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®æ—¥åˆ¥çµ±è¨ˆç®—å‡ºå¯èƒ½æ€§

### æ¤œè¨¼ç’°å¢ƒ
```
Instagram User ID: 17841455808057230
Account: yamasa_renovation
æ¤œè¨¼æœŸé–“: 2025-06-25
API Version: Facebook Graph API v23.0
```

---

## ğŸ“Š å–å¾—å¯èƒ½ãƒ‡ãƒ¼ã‚¿å®Œå…¨ãƒªã‚¹ãƒˆ

### 1. Instagram Insights API ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆ2å€‹ï¼‰

#### âœ… follower_countï¼ˆãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ï¼‰
```http
GET https://graph.facebook.com/{ig-user-id}/insights
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
```json
{
  "metric": "follower_count",
  "since": "2025-06-24",
  "until": "2025-06-25", 
  "period": "day",
  "access_token": "{access_token}"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**
```json
{
  "data": [
    {
      "name": "follower_count",
      "period": "day",
      "values": [
        {
          "value": 0,
          "end_time": "2025-06-24T07:00:00+0000"
        }
      ]
    }
  ]
}
```

**ç‰¹å¾´:**
- æ—¥åˆ¥ãƒ‡ãƒ¼ã‚¿: 1ä»¶å–å¾—å¯èƒ½
- é€±åˆ¥ãƒ‡ãƒ¼ã‚¿: å¯¾å¿œä¸å¯
- ãƒ‡ãƒ¼ã‚¿å‹: integer

#### âœ… reachï¼ˆãƒªãƒ¼ãƒæ•°ï¼‰
```http
GET https://graph.facebook.com/{ig-user-id}/insights
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
```json
{
  "metric": "reach",
  "since": "2025-06-18",
  "until": "2025-06-25",
  "period": "day",
  "access_token": "{access_token}"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**
```json
{
  "data": [
    {
      "name": "reach", 
      "period": "day",
      "values": [
        {
          "value": 9766,
          "end_time": "2025-06-18T07:00:00+0000"
        },
        {
          "value": 11186,
          "end_time": "2025-06-19T07:00:00+0000"
        }
      ]
    }
  ]
}
```

**ç‰¹å¾´:**
- æ—¥åˆ¥ãƒ‡ãƒ¼ã‚¿: è¤‡æ•°ä»¶å–å¾—å¯èƒ½ï¼ˆæ™‚ç³»åˆ—ï¼‰
- é€±åˆ¥ãƒ‡ãƒ¼ã‚¿: æœ€å¤§7ä»¶å–å¾—å¯èƒ½
- ãƒ‡ãƒ¼ã‚¿å‹: integer

### 2. åŸºæœ¬ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆ11å€‹ï¼‰

#### API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```http
GET https://graph.facebook.com/{ig-user-id}
```

#### åˆ©ç”¨å¯èƒ½ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€è¦§

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ | æ—¥åˆ¥çµ±è¨ˆã§ã®ç”¨é€” |
|-----------|---------|------|----------------|
| `id` | string | Instagram User ID | è­˜åˆ¥ç”¨ |
| `username` | string | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ  | è¡¨ç¤ºç”¨ |
| `name` | string | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå | è¡¨ç¤ºç”¨ |
| `ig_id` | integer | Instagram IDï¼ˆæ•°å€¤ï¼‰ | è­˜åˆ¥ç”¨ |
| `media_count` | integer | æŠ•ç¨¿æ•° | æ—¥åˆ¥æŠ•ç¨¿æ•°è¨ˆç®— |
| `followers_count` | integer | ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•° | **follower_count ã®ä»£æ›¿** |
| `follows_count` | integer | ãƒ•ã‚©ãƒ­ãƒ¼æ•° | **following_count ã®ä»£æ›¿** |
| `biography` | string | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ–‡ | ãƒ¡ã‚¿æƒ…å ± |
| `website` | string | ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆURL | ãƒ¡ã‚¿æƒ…å ± |
| `profile_picture_url` | string | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL | è¡¨ç¤ºç”¨ |
| `is_published` | boolean | å…¬é–‹çŠ¶æ…‹ | ãƒ¡ã‚¿æƒ…å ± |

#### ä¸€æ‹¬å–å¾—ä¾‹
```http
GET https://graph.facebook.com/{ig-user-id}?fields=followers_count,follows_count,media_count,username,name
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**
```json
{
  "followers_count": 455,
  "follows_count": 17,
  "media_count": 411,
  "username": "yamasa_renovation",
  "name": "ãƒ¤ãƒã‚µãƒªãƒãƒ™ | é¹¿å…å³¶å¸‚ / å§¶è‰¯å¸‚ / æ—¥ç½®å¸‚ | ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ / ãƒªãƒ•ã‚©ãƒ¼ãƒ ",
  "id": "17841455808057230"
}
```

### 3. æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿é›†ç´„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆ6å€‹ï¼‰

#### ãƒ‡ãƒ¼ã‚¿å–å¾—æ–¹æ³•
```http
GET https://graph.facebook.com/{ig-user-id}/media
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
```json
{
  "fields": "id,timestamp,media_type,like_count,comments_count",
  "access_token": "{access_token}",
  "limit": 50
}
```

#### ç®—å‡ºå¯èƒ½ãªæ—¥åˆ¥ãƒ¡ãƒˆãƒªã‚¯ã‚¹

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ç®—å‡ºæ–¹æ³• | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ |
|-----------|---------|---------|------|
| `daily_posts_count` | æ—¥åˆ¥æŠ•ç¨¿æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ | integer | ãã®æ—¥ã®æŠ•ç¨¿æ•° |
| `daily_total_likes` | æ—¥åˆ¥ã„ã„ã­æ•°ã‚’åˆè¨ˆ | integer | ãã®æ—¥æŠ•ç¨¿ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã„ã„ã­åˆè¨ˆ |
| `daily_total_comments` | æ—¥åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’åˆè¨ˆ | integer | ãã®æ—¥æŠ•ç¨¿ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚³ãƒ¡ãƒ³ãƒˆåˆè¨ˆ |
| `daily_avg_likes_per_post` | ã„ã„ã­åˆè¨ˆ Ã· æŠ•ç¨¿æ•° | decimal | ãã®æ—¥ã®æŠ•ç¨¿ã‚ãŸã‚Šå¹³å‡ã„ã„ã­æ•° |
| `daily_avg_comments_per_post` | ã‚³ãƒ¡ãƒ³ãƒˆåˆè¨ˆ Ã· æŠ•ç¨¿æ•° | decimal | ãã®æ—¥ã®æŠ•ç¨¿ã‚ãŸã‚Šå¹³å‡ã‚³ãƒ¡ãƒ³ãƒˆæ•° |
| `daily_media_type_distribution` | ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ—åˆ¥é›†è¨ˆ | json | VIDEO/CAROUSEL_ALBUM/IMAGE ã®åˆ†å¸ƒ |

#### é›†ç´„å‡¦ç†ä¾‹ï¼ˆPythonï¼‰
```python
from datetime import datetime
from collections import defaultdict

def aggregate_posts_by_date(posts):
    daily_stats = defaultdict(lambda: {
        'posts_count': 0,
        'total_likes': 0,
        'total_comments': 0,
        'media_types': set()
    })
    
    for post in posts:
        timestamp = post.get('timestamp', '')
        if timestamp:
            post_date = timestamp.split('T')[0]  # YYYY-MM-DD
            
            daily_stats[post_date]['posts_count'] += 1
            daily_stats[post_date]['total_likes'] += post.get('like_count', 0)
            daily_stats[post_date]['total_comments'] += post.get('comments_count', 0)
            daily_stats[post_date]['media_types'].add(post.get('media_type', 'unknown'))
    
    # å¹³å‡å€¤è¨ˆç®—
    for date, stats in daily_stats.items():
        if stats['posts_count'] > 0:
            stats['avg_likes_per_post'] = stats['total_likes'] / stats['posts_count']
            stats['avg_comments_per_post'] = stats['total_comments'] / stats['posts_count']
        else:
            stats['avg_likes_per_post'] = 0
            stats['avg_comments_per_post'] = 0
        
        stats['media_type_distribution'] = dict(
            Counter(stats['media_types'])
        )
    
    return daily_stats
```

---

## âŒ å–å¾—ä¸å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿

### æœŸå¾…ã•ã‚Œã¦ã„ãŸãŒåˆ©ç”¨ä¸å¯ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ç†ç”± | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|-----------|------|----------------|
| `impressions` | v22ä»¥é™å»ƒæ­¢ | "Starting from version 22 and above, the impressions metric is no longer supported" |
| `profile_views` | ãƒ‡ãƒ¼ã‚¿ãªã— | "should be specified with parameter metric_type=total_value" â†’ ãƒ‡ãƒ¼ã‚¿ãªã— |
| `website_clicks` | ãƒ‡ãƒ¼ã‚¿ãªã— | "should be specified with parameter metric_type=total_value" â†’ ãƒ‡ãƒ¼ã‚¿ãªã— |
| `new_followers` | åˆ©ç”¨ä¸å¯ | "metric[0] must be one of the following values..." |
| `accounts_engaged` | ãƒ‡ãƒ¼ã‚¿ãªã— | "should be specified with parameter metric_type=total_value" â†’ ãƒ‡ãƒ¼ã‚¿ãªã— |
| `total_interactions` | ãƒ‡ãƒ¼ã‚¿ãªã— | "should be specified with parameter metric_type=total_value" â†’ ãƒ‡ãƒ¼ã‚¿ãªã— |

### Threadsé–¢é€£ãƒ¡ãƒˆãƒªã‚¯ã‚¹
```
threads_likes, threads_replies, threads_followers, etc.
â†’ "is/are not supported on this Instagram account"
```

---

## ğŸ’» å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### ãƒ‡ãƒ¼ã‚¿åé›†æˆ¦ç•¥

#### 1. æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿åé›†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Insights API â”‚    â”‚  Basic Fields   â”‚    â”‚ Post Aggregationâ”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ follower_countâ”‚    â”‚ â€¢ followers_countâ”‚   â”‚ â€¢ daily_posts   â”‚
â”‚ â€¢ reach         â”‚    â”‚ â€¢ follows_count â”‚    â”‚ â€¢ daily_likes   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Daily Stats DB  â”‚
                      â”‚                 â”‚
                      â”‚ Combined Data   â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. æ¨å¥¨å®Ÿè£…é †åº

##### ãƒ•ã‚§ãƒ¼ã‚º1: åŸºæœ¬å®Ÿè£…
```python
def collect_daily_basic_data(instagram_user_id, access_token, target_date):
    """åŸºæœ¬çš„ãªæ—¥åˆ¥ãƒ‡ãƒ¼ã‚¿åé›†"""
    
    # 1. åŸºæœ¬ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±å–å¾—
    account_data = get_basic_account_fields(instagram_user_id, access_token)
    
    # 2. Insights ãƒ¡ãƒˆãƒªã‚¯ã‚¹å–å¾—
    insights_data = get_insights_metrics(instagram_user_id, access_token, target_date)
    
    # 3. ãƒ‡ãƒ¼ã‚¿çµ±åˆ
    daily_stats = {
        'stats_date': target_date,
        'followers_count': account_data.get('followers_count'),
        'following_count': account_data.get('follows_count'),
        'reach': insights_data.get('reach', 0),
        'follower_count_change': insights_data.get('follower_count', 0)
    }
    
    return daily_stats
```

##### ãƒ•ã‚§ãƒ¼ã‚º2: æŠ•ç¨¿é›†ç´„è¿½åŠ 
```python
def collect_daily_comprehensive_data(instagram_user_id, access_token, target_date):
    """åŒ…æ‹¬çš„ãªæ—¥åˆ¥ãƒ‡ãƒ¼ã‚¿åé›†"""
    
    # ãƒ•ã‚§ãƒ¼ã‚º1ã®åŸºæœ¬ãƒ‡ãƒ¼ã‚¿
    daily_stats = collect_daily_basic_data(instagram_user_id, access_token, target_date)
    
    # æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿é›†ç´„
    posts_data = get_posts_for_date(instagram_user_id, access_token, target_date)
    aggregated_posts = aggregate_posts_by_date(posts_data)
    
    # æŠ•ç¨¿é›†ç´„ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆ
    if target_date in aggregated_posts:
        daily_stats.update({
            'posts_count': aggregated_posts[target_date]['posts_count'],
            'total_likes': aggregated_posts[target_date]['total_likes'], 
            'total_comments': aggregated_posts[target_date]['total_comments'],
            'avg_likes_per_post': aggregated_posts[target_date]['avg_likes_per_post'],
            'avg_comments_per_post': aggregated_posts[target_date]['avg_comments_per_post']
        })
    
    return daily_stats
```

#### 3. APIå‘¼ã³å‡ºã—é–¢æ•°å®Ÿè£…

##### Insights API å‘¼ã³å‡ºã—
```python
def get_insights_metrics(instagram_user_id, access_token, target_date):
    """Insights ãƒ¡ãƒˆãƒªã‚¯ã‚¹å–å¾—"""
    
    url = f"https://graph.facebook.com/{instagram_user_id}/insights"
    
    # è¤‡æ•°ãƒ¡ãƒˆãƒªã‚¯ã‚¹åŒæ™‚å–å¾—
    params = {
        'metric': 'follower_count,reach',
        'since': target_date,
        'until': target_date,
        'period': 'day',
        'access_token': access_token
    }
    
    response = requests.get(url, params=params)
    response.raise_for_status()
    
    data = response.json()
    
    # ãƒ¡ãƒˆãƒªã‚¯ã‚¹å€¤ã‚’è¾æ›¸ã«å¤‰æ›
    metrics = {}
    for metric_data in data.get('data', []):
        metric_name = metric_data.get('name')
        values = metric_data.get('values', [])
        if values:
            metrics[metric_name] = values[0].get('value', 0)
    
    return metrics
```

##### åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—
```python
def get_basic_account_fields(instagram_user_id, access_token):
    """åŸºæœ¬ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—"""
    
    url = f"https://graph.facebook.com/{instagram_user_id}"
    
    params = {
        'fields': 'followers_count,follows_count,media_count,username,name',
        'access_token': access_token
    }
    
    response = requests.get(url, params=params)
    response.raise_for_status()
    
    return response.json()
```

#### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆï¼ˆä¿®æ­£ç‰ˆï¼‰

##### å®Ÿéš›ã«å–å¾—å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ããƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ
```sql
CREATE TABLE daily_stats (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    account_id UUID REFERENCES instagram_accounts(id),
    stats_date DATE NOT NULL,
    
    -- åŸºæœ¬ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‹ã‚‰å–å¾—
    followers_count INTEGER NOT NULL,           -- åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰
    following_count INTEGER NOT NULL,           -- åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰ (follows_count)
    
    -- Insights API ã‹ã‚‰å–å¾—
    reach INTEGER DEFAULT 0,                    -- Insights API
    follower_count_change INTEGER DEFAULT 0,   -- Insights API (follower_count)
    
    -- æŠ•ç¨¿é›†ç´„ã‹ã‚‰ç®—å‡º
    posts_count INTEGER DEFAULT 0,             -- æŠ•ç¨¿é›†ç´„
    total_likes INTEGER DEFAULT 0,             -- æŠ•ç¨¿é›†ç´„
    total_comments INTEGER DEFAULT 0,          -- æŠ•ç¨¿é›†ç´„
    avg_likes_per_post DECIMAL(8,2) DEFAULT 0, -- æŠ•ç¨¿é›†ç´„
    avg_comments_per_post DECIMAL(8,2) DEFAULT 0, -- æŠ•ç¨¿é›†ç´„
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    UNIQUE(account_id, stats_date)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_daily_stats_account_date ON daily_stats(account_id, stats_date);
CREATE INDEX idx_daily_stats_date ON daily_stats(stats_date);
```

##### å–å¾—ä¸å¯èƒ½ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‰Šé™¤
```sql
-- ä»¥ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å‰Šé™¤
-- profile_views        (å–å¾—ä¸å¯)
-- website_clicks       (å–å¾—ä¸å¯)  
-- new_followers        (å–å¾—ä¸å¯)
```

---

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ãƒ¬ãƒ¼ãƒˆåˆ¶é™

### APIåˆ¶é™
- **åŸºæœ¬åˆ¶é™**: 200ã‚³ãƒ¼ãƒ«/æ™‚é–“/ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **æ¨å¥¨é »åº¦**: 1æ—¥1å›ï¼ˆæ—©æœå®Ÿè¡Œï¼‰
- **å¿…è¦ã‚³ãƒ¼ãƒ«æ•°**: 
  - Insights API: 1ã‚³ãƒ¼ãƒ«ï¼ˆè¤‡æ•°ãƒ¡ãƒˆãƒªã‚¯ã‚¹åŒæ™‚å–å¾—ï¼‰
  - åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: 1ã‚³ãƒ¼ãƒ«
  - æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿: 1ã‚³ãƒ¼ãƒ«ï¼ˆ50ä»¶ã¾ã§ï¼‰
  - **åˆè¨ˆ**: 3ã‚³ãƒ¼ãƒ«/æ—¥

### æœ€é©åŒ–æˆ¦ç•¥
1. **è¤‡æ•°ãƒ¡ãƒˆãƒªã‚¯ã‚¹åŒæ™‚å–å¾—**: `follower_count,reach` ã‚’1å›ã®APIã‚³ãƒ¼ãƒ«ã§å–å¾—
2. **åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å„ªå…ˆ**: followers_count ã¯åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰å–å¾—ï¼ˆã‚ˆã‚Šå®‰å®šï¼‰
3. **æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: 1æ—¥1å›å–å¾—ã—ã¦é›†ç´„ãƒ‡ãƒ¼ã‚¿ã‚’ç®—å‡º
4. **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: Insights API ãŒåˆ©ç”¨ä¸å¯ã®å ´åˆã¯åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ä»£æ›¿

---

## ğŸ”§ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ä¸»è¦ãªã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³

#### 1. ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ãªã—
```json
{
  "data": [
    {
      "name": "follower_count",
      "values": []
    }
  ]
}
```
**å¯¾å‡¦**: åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã® `followers_count` ã§ä»£æ›¿

#### 2. APIåˆ¶é™ã‚¨ãƒ©ãƒ¼  
```json
{
  "error": {
    "message": "Application request limit reached",
    "type": "OAuthException",
    "code": 4
  }
}
```
**å¯¾å‡¦**: 1æ™‚é–“å¾…æ©Ÿå¾Œãƒªãƒˆãƒ©ã‚¤ã€ã¾ãŸã¯åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ä»£æ›¿

#### 3. ãƒ¡ãƒˆãƒªã‚¯ã‚¹åˆ©ç”¨ä¸å¯
```json
{
  "error": {
    "message": "The following metrics should be specified with parameter metric_type=total_value",
    "type": "OAuthException", 
    "code": 100
  }
}
```
**å¯¾å‡¦**: ãã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€ä»£æ›¿ãƒ‡ãƒ¼ã‚¿ã§è£œå®Œ

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…ä¾‹
```python
def robust_daily_stats_collection(instagram_user_id, access_token, target_date):
    """å …ç‰¢ãªæ—¥åˆ¥ãƒ‡ãƒ¼ã‚¿åé›†"""
    
    daily_stats = {
        'stats_date': target_date,
        'data_sources': []
    }
    
    try:
        # 1. åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—ï¼ˆæœ€ã‚‚å®‰å®šï¼‰
        account_data = get_basic_account_fields(instagram_user_id, access_token)
        daily_stats.update({
            'followers_count': account_data.get('followers_count', 0),
            'following_count': account_data.get('follows_count', 0)
        })
        daily_stats['data_sources'].append('basic_fields')
        
    except Exception as e:
        logger.error(f"åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—ã‚¨ãƒ©ãƒ¼: {e}")
        return None
    
    try:
        # 2. Insights API å–å¾—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        insights_data = get_insights_metrics(instagram_user_id, access_token, target_date)
        daily_stats.update({
            'reach': insights_data.get('reach', 0),
            'follower_count_change': insights_data.get('follower_count', 0)
        })
        daily_stats['data_sources'].append('insights_api')
        
    except Exception as e:
        logger.warning(f"Insights API ã‚¨ãƒ©ãƒ¼ã€åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã®ã¿ä½¿ç”¨: {e}")
        daily_stats.update({
            'reach': 0,
            'follower_count_change': 0
        })
    
    try:
        # 3. æŠ•ç¨¿é›†ç´„ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        posts_data = get_posts_for_date(instagram_user_id, access_token, target_date)
        aggregated = aggregate_posts_by_date(posts_data)
        
        if target_date in aggregated:
            daily_stats.update(aggregated[target_date])
            daily_stats['data_sources'].append('post_aggregation')
        
    except Exception as e:
        logger.warning(f"æŠ•ç¨¿é›†ç´„ã‚¨ãƒ©ãƒ¼: {e}")
    
    return daily_stats
```

---

## ğŸ“Š å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å¿…é ˆå®Ÿè£…é …ç›®
- [ ] åŸºæœ¬ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—æ©Ÿèƒ½
- [ ] Insights API å‘¼ã³å‡ºã—æ©Ÿèƒ½
- [ ] æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»é›†ç´„æ©Ÿèƒ½  
- [ ] æ—¥åˆ¥ãƒ‡ãƒ¼ã‚¿çµ±åˆå‡¦ç†
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜æ©Ÿèƒ½
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] ãƒ­ã‚°æ©Ÿèƒ½

### ãƒ‡ãƒ¼ã‚¿å“è³ªç¢ºä¿
- [ ] NULLå€¤ã®é©åˆ‡ãªå‡¦ç†
- [ ] ãƒ‡ãƒ¼ã‚¿å‹å¤‰æ›ã®å®Ÿè£…
- [ ] é‡è¤‡ãƒ‡ãƒ¼ã‚¿ã®é˜²æ­¢ï¼ˆUNIQUEåˆ¶ç´„ï¼‰
- [ ] æ—¥ä»˜æ¤œè¨¼

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] è¤‡æ•°ãƒ¡ãƒˆãƒªã‚¯ã‚¹åŒæ™‚å–å¾—
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œ
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ï¼ˆæŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ï¼‰
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š

### ç›£è¦–ãƒ»é‹ç”¨
- [ ] APIä½¿ç”¨é‡ã®ç›£è¦–
- [ ] ãƒ‡ãƒ¼ã‚¿åé›†çŠ¶æ³ã®è¿½è·¡
- [ ] ã‚¨ãƒ©ãƒ¼ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
- [ ] ãƒ‡ãƒ¼ã‚¿å“è³ªãƒ¬ãƒãƒ¼ãƒˆ

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### çŸ­æœŸï¼ˆ1-2é€±é–“ï¼‰
1. **åŸºæœ¬å®Ÿè£…**: ãƒ•ã‚§ãƒ¼ã‚º1ã®å®Ÿè£…ï¼ˆåŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ + Insights APIï¼‰
2. **ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰**: é–‹ç™ºç’°å¢ƒã§ã®ãƒ‡ãƒ¼ã‚¿åé›†ãƒ†ã‚¹ãƒˆ
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å …ç‰¢æ€§ã®ç¢ºä¿

### ä¸­æœŸï¼ˆ1ãƒ¶æœˆï¼‰
1. **æŠ•ç¨¿é›†ç´„å®Ÿè£…**: ãƒ•ã‚§ãƒ¼ã‚º2ã®å®Ÿè£…
2. **é‹ç”¨ç›£è¦–**: ãƒ­ã‚°ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½
3. **ãƒ‡ãƒ¼ã‚¿å“è³ª**: ç•°å¸¸å€¤æ¤œçŸ¥ãƒ»ä¿®æ­£æ©Ÿèƒ½

### é•·æœŸï¼ˆ3ãƒ¶æœˆï¼‰
1. **analyticsæ©Ÿèƒ½æ‹¡å¼µ**: ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—æ¤œè¨
2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: å¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†å¯¾å¿œ
3. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒ–**: Webhookæ´»ç”¨æ¤œè¨

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [Meta for Developers - Instagram Platform](https://developers.facebook.com/docs/instagram-platform/)
- [Instagram Graph API Reference](https://developers.facebook.com/docs/instagram-api/)
- [Instagram Insights API](https://developers.facebook.com/docs/instagram-api/reference/ig-user/insights)

**æ¤œè¨¼ãƒ•ã‚¡ã‚¤ãƒ«**: `/verification/about-daily-stats/`  
**æ¤œè¨¼çµæœ**: `/verification/about-daily-stats/output-json/`  
**æœ€çµ‚æ›´æ–°**: 2025-06-25