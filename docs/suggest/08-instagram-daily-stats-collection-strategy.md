# Instagram Daily Stats Collection Strategy
Instagram日次統計データの収集戦略と実装提案

**調査日**: 2025-07-01  
**対象**: Instagram Daily Stats モデルの各フィールドの収集可能性調査  
**テスト対象アカウント**: 3アカウント（ys_dolphin, realestate.ayaha, rasisa.jp）

---

## 📊 調査結果サマリー

### テスト結果概要
- **基本アカウントデータ**: ✅ 全アカウントで取得可能（現在値のみ）
- **アカウントレベルインサイト**: ❌ 全アカウントで取得不可（データなし）
- **投稿レベルインサイト**: ✅ 取得可能（詳細なメトリクス利用可能）

---

## 🔍 Instagram Daily Stats モデル分析

### フィールド別収集可能性

| フィールド | データ型 | 収集可能性 | 取得方法 | 過去遡及 | 備考 |
|-----------|---------|-----------|---------|---------|------|
| **アカウント基本指標** | | | | | |
| `followers_count` | Integer | ✅ 可能 | 基本アカウントAPI | ❌ 不可 | 現在値のみ |
| `following_count` | Integer | ✅ 可能 | 基本アカウントAPI | ❌ 不可 | 現在値のみ |
| **インサイト指標** | | | | | |
| `reach` | Integer | ❌ 不可 | インサイトAPI | ❌ 不可 | データ提供なし |
| `follower_count_change` | Integer | ❌ 不可 | インサイトAPI | ❌ 不可 | データ提供なし |
| **投稿関連指標** | | | | | |
| `posts_count` | Integer | ✅ 可能 | 基本アカウントAPI | ❌ 不可 | 現在値のみ |
| `total_likes` | Integer | ✅ 可能 | 投稿データ集約 | ✅ 可能 | 日別集約可能 |
| `total_comments` | Integer | ✅ 可能 | 投稿データ集約 | ✅ 可能 | 日別集約可能 |
| **平均値** | | | | | |
| `avg_likes_per_post` | Float | ✅ 可能 | 計算フィールド | ✅ 可能 | 投稿データから算出 |
| `avg_comments_per_post` | Float | ✅ 可能 | 計算フィールド | ✅ 可能 | 投稿データから算出 |

---

## 📈 実際のデータ取得結果

### 基本アカウントデータ（全アカウント取得成功）
```
ys_dolphin: followers=742, following=411, media=388
realestate.ayaha: followers=792, following=152, media=114  
rasisa.jp: followers=102, following=133, media=43
```

### インサイトデータ（全アカウント取得失敗）
```
全アカウント・全日付: reach=0, follower_count_change=0
テスト日付: 今日、昨日、7日前 → すべて空データ
```

### 投稿レベルインサイト（取得成功例）
```
ys_dolphin の最近の投稿:
- Post 1: likes=11, comments=0, views=146, reach=80, saved=0, shares=0
- Post 2: likes=10, comments=0, views=155, reach=85, saved=0, shares=0
```

---

## 🚫 Instagram API の制限事項

### 1. アカウントレベルインサイトの制限
- **follower_count, reach**: Meta公式ドキュメントでは利用可能とされているが、実際にはデータが提供されない
- **権限問題**: Business Account認証が完了していても、多くのアカウントでインサイトデータが空
- **アカウント規模**: フォロワー数や活動レベルに関係なく、すべてのテストアカウントで同様の結果

### 2. 過去データの制限
- **基本データ**: followers_count, following_count, media_count は現在値のみ
- **履歴なし**: 任意の過去日付での値は取得不可
- **API設計**: Instagram APIは履歴データの提供を想定していない

---

## ✅ 収集可能なデータと戦略

### 現在値として収集可能
1. **アカウント基本情報**
   - フォロワー数、フォロー数、投稿数
   - 毎日記録することで履歴を構築

2. **投稿関連データ**
   - 各投稿のいいね数、コメント数
   - 投稿日別の集約データ
   - エンゲージメント率の計算

3. **投稿レベルインサイト**
   - reach（投稿別）
   - views, saved, shares
   - total_interactions

---

## 🎯 推奨データ収集戦略

### 1. 毎日収集すべきデータ

#### A. アカウント基本データ収集
```python
# 毎日実行: 基本アカウントデータ収集
def collect_daily_basic_stats():
    - followers_count (現在値)
    - following_count (現在値) 
    - posts_count (現在値)
    - 前日比計算（自動算出）
```

#### B. 投稿データ収集・集約
```python
# 毎日実行: 新規投稿とメトリクス収集
def collect_daily_post_stats():
    - 新規投稿の検出・保存
    - 投稿メトリクス（いいね、コメント）収集
    - 日別集約データ計算
```

### 2. 収集頻度とタイミング

| データ種別 | 収集頻度 | 推奨時間 | API使用量 | 用途 |
|-----------|---------|---------|-----------|------|
| **基本アカウントデータ** | 1日1回 | 毎日09:00 | 低 | 成長トレンド分析 |
| **新規投稿データ** | 1日4回 | 06:00,12:00,18:00,24:00 | 中 | リアルタイム監視 |
| **投稿メトリクス更新** | 1日1回 | 毎日21:00 | 高 | パフォーマンス分析 |
| **月次集約処理** | 月1回 | 月初02:00 | 低 | レポート生成 |

### 3. データ品質管理

#### A. データ検証
```python
def validate_daily_stats():
    - 前日比の異常値検出（±20%以上の変動）
    - 欠損データの補完処理
    - API障害時の代替データ取得
```

#### B. エラーハンドリング
```python
def handle_collection_errors():
    - API制限時の自動リトライ
    - 部分的失敗時の継続処理
    - データ整合性チェック
```

---

## 🛠️ 実装推奨手順

### Phase 1: 基本データ収集の確立（1-2週間）
1. **daily_collection_service の強化**
   - 基本アカウントデータの定期収集実装
   - 前日比自動計算機能追加
   - エラーハンドリング強化

2. **スケジューラ設定**
   - cron job または Celery での定期実行
   - 複数アカウントの順次処理

### Phase 2: 投稿データ統合（2-3週間）
1. **投稿データ集約機能**
   - 日別投稿メトリクス集約
   - エンゲージメント率計算
   - メディアタイプ別分析

2. **データ品質向上**
   - 異常値検出・補正
   - データ完全性チェック

### Phase 3: 分析機能拡張（3-4週間）
1. **トレンド分析**
   - 成長率計算
   - 季節性分析
   - 競合比較

2. **レポート自動生成**
   - 週次・月次レポート
   - パフォーマンスアラート

---

## 📋 具体的な実装タスク

### 1. daily_collection_service 改修
```python
class EnhancedDailyCollectorService:
    async def collect_account_basic_stats(self, account_id: str):
        """基本アカウントデータ収集・前日比計算"""
        
    async def collect_post_aggregations(self, account_id: str, target_date: date):
        """指定日の投稿データ集約"""
        
    async def calculate_growth_metrics(self, account_id: str):
        """成長指標自動計算"""
```

### 2. 新しいスケジューラスクリプト作成
```bash
# scripts/daily_stats_collector.py
# 毎日自動実行される統合収集スクリプト
```

### 3. データ品質モニタリング
```python
# app/services/data_quality/stats_validator.py
# データ品質チェック・異常値検出
```

---

## 🎯 期待される効果

### 短期的効果（1ヶ月後）
- **履歴データ蓄積**: 30日分の正確な基本統計
- **トレンド可視化**: フォロワー成長率の日次追跡
- **投稿分析**: エンゲージメント率の投稿別・日別分析

### 中期的効果（3ヶ月後）
- **季節性分析**: 曜日・月別のパフォーマンス傾向
- **コンテンツ最適化**: 高エンゲージメント投稿の特徴分析
- **競合ベンチマーク**: 同業界アカウントとの比較分析

### 長期的効果（6ヶ月後）
- **予測分析**: 成長予測モデルの構築
- **ROI測定**: マーケティング活動とフォロワー成長の相関分析
- **自動最適化**: AI による投稿時間・内容の推奨

---

## ⚠️ 注意事項

1. **API制限遵守**: 200コール/時間の制限内での設計必須
2. **データプライバシー**: アクセストークンの適切な管理
3. **障害対応**: API障害時の代替手段準備
4. **スケーラビリティ**: アカウント数増加への対応設計

---

**結論**: Instagram APIのアカウントレベルインサイトは利用できないが、基本データと投稿データを組み合わせることで、十分な分析価値のある日次統計を構築可能。毎日の継続的データ収集が成功の鍵となる。